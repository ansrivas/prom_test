use arrow::array::{ Int64Array, StringArray};
use chrono::{Datelike, Duration, TimeZone, Timelike, Utc};
use dashmap::DashMap;
use datafusion::arrow::{
    array::ArrayRef, datatypes::DataType, record_batch::RecordBatch,
};
use datafusion::{error::Result, physical_plan::Accumulator};
use datafusion::{logical_expr::Volatility, prelude::*, scalar::ScalarValue};
use datafusion_expr::{
    AccumulatorFunctionImplementation, AggregateUDF, ReturnTypeFunction, Signature,
    StateTypeFunction,
};
use serde::{Deserialize, Serialize};
use std::sync::Arc;

#[macro_use]
extern crate lazy_static;

lazy_static! {
    pub static ref DATA: DashMap<String, std::sync::Mutex<bool>> = DashMap::new();
}

#[derive(Clone, Debug, Default, PartialEq, Serialize, Deserialize)]
struct Results {
    pub metric: ResultMetric,
    pub values: Vec<ResultValue>,
}

#[derive(Clone, Debug, Default, PartialEq, Serialize, Deserialize)]
struct ResultMetric {
    pub __name__: String,
    pub cluster: String,
    pub container: String,
    pub endpoint: String,
    pub instance: String,
    pub job: String,
    pub namespace: String,
}

#[derive(Clone, Debug, Default, PartialEq, Serialize, Deserialize)]
struct ResultValue {
    pub timestamp: i64,
    pub value: String,
}

static ORIGIN_VALUE: &str = r#"{"metric":{"__name__":"zo_http_incoming_requests","cluster":"zo1","container":"zincobserve","endpoint":"http","exported_endpoint":"/_json","exported_instance":"zo1-zincobserve-ingester-0","instance":"10.24.0.164:5080","job":"zo1-zincobserve-ingester","namespace":"ziox-dev","organization":"default","pod":"zo1-zincobserve-ingester-0","role":"ingester","service":"zo1-zincobserve-ingester","status":"200","stream":"default","stream_type":"logs"},"values":[[1680161100,"890386"],[1680161101,"890386"],[1680161102,"890386"],[1680161103,"890386"],[1680161104,"890386"],[1680161105,"890386"],[1680161106,"890386"],[1680161107,"890513"],[1680161108,"890513"],[1680161109,"890513"],[1680161110,"890513"],[1680161111,"890513"],[1680161112,"890513"],[1680161113,"890513"],[1680161114,"890513"],[1680161115,"890513"],[1680161116,"890513"],[1680161117,"890513"],[1680161118,"890513"],[1680161119,"890513"],[1680161120,"890513"],[1680161121,"890513"],[1680161122,"890643"],[1680161123,"890643"],[1680161124,"890643"],[1680161125,"890643"],[1680161126,"890643"],[1680161127,"890643"],[1680161128,"890643"],[1680161129,"890643"],[1680161130,"890643"],[1680161131,"890643"],[1680161132,"890643"],[1680161133,"890643"],[1680161134,"890643"],[1680161135,"890643"],[1680161136,"890643"],[1680161137,"890773"],[1680161138,"890773"],[1680161139,"890773"],[1680161140,"890773"],[1680161141,"890773"],[1680161142,"890773"],[1680161143,"890773"],[1680161144,"890773"],[1680161145,"890773"],[1680161146,"890773"],[1680161147,"890773"],[1680161148,"890773"],[1680161149,"890773"],[1680161150,"890773"],[1680161151,"890773"],[1680161152,"890904"],[1680161153,"890904"],[1680161154,"890904"],[1680161155,"890904"],[1680161156,"890904"],[1680161157,"890904"],[1680161158,"890904"],[1680161159,"890904"],[1680161160,"890904"],[1680161161,"890904"],[1680161162,"890904"],[1680161163,"890904"],[1680161164,"890904"],[1680161165,"890904"],[1680161166,"890904"],[1680161167,"891031"],[1680161168,"891031"],[1680161169,"891031"],[1680161170,"891031"],[1680161171,"891031"],[1680161172,"891031"],[1680161173,"891031"],[1680161174,"891031"],[1680161175,"891031"],[1680161176,"891031"],[1680161177,"891031"],[1680161178,"891031"],[1680161179,"891031"],[1680161180,"891031"],[1680161181,"891031"],[1680161182,"891165"],[1680161183,"891165"],[1680161184,"891165"],[1680161185,"891165"],[1680161186,"891165"],[1680161187,"891165"],[1680161188,"891165"],[1680161189,"891165"],[1680161190,"891165"],[1680161191,"891165"],[1680161192,"891165"],[1680161193,"891165"],[1680161194,"891165"],[1680161195,"891165"],[1680161196,"891165"],[1680161197,"891291"],[1680161198,"891291"],[1680161199,"891291"],[1680161200,"891291"],[1680161201,"891291"],[1680161202,"891291"],[1680161203,"891291"],[1680161204,"891291"],[1680161205,"891291"],[1680161206,"891291"],[1680161207,"891291"],[1680161208,"891291"],[1680161209,"891291"],[1680161210,"891291"],[1680161211,"891291"],[1680161212,"891419"],[1680161213,"891419"],[1680161214,"891419"],[1680161215,"891419"],[1680161216,"891419"],[1680161217,"891419"],[1680161218,"891419"],[1680161219,"891419"],[1680161220,"891419"],[1680161221,"891419"],[1680161222,"891419"],[1680161223,"891419"],[1680161224,"891419"],[1680161225,"891419"],[1680161226,"891419"],[1680161227,"891548"],[1680161228,"891548"],[1680161229,"891548"],[1680161230,"891548"],[1680161231,"891548"],[1680161232,"891548"],[1680161233,"891548"],[1680161234,"891548"],[1680161235,"891548"],[1680161236,"891548"],[1680161237,"891548"],[1680161238,"891548"],[1680161239,"891548"],[1680161240,"891548"],[1680161241,"891548"],[1680161242,"891677"],[1680161243,"891677"],[1680161244,"891677"],[1680161245,"891677"],[1680161246,"891677"],[1680161247,"891677"],[1680161248,"891677"],[1680161249,"891677"],[1680161250,"891677"],[1680161251,"891677"],[1680161252,"891677"],[1680161253,"891677"],[1680161254,"891677"],[1680161255,"891677"],[1680161256,"891677"],[1680161257,"891805"],[1680161258,"891805"],[1680161259,"891805"],[1680161260,"891805"],[1680161261,"891805"],[1680161262,"891805"],[1680161263,"891805"],[1680161264,"891805"],[1680161265,"891805"],[1680161266,"891805"],[1680161267,"891805"],[1680161268,"891805"],[1680161269,"891805"],[1680161270,"891805"],[1680161271,"891805"],[1680161272,"891935"],[1680161273,"891935"],[1680161274,"891935"],[1680161275,"891935"],[1680161276,"891935"],[1680161277,"891935"],[1680161278,"891935"],[1680161279,"891935"],[1680161280,"891935"],[1680161281,"891935"],[1680161282,"891935"],[1680161283,"891935"],[1680161284,"891935"],[1680161285,"891935"],[1680161286,"891935"],[1680161287,"892061"],[1680161288,"892061"],[1680161289,"892061"],[1680161290,"892061"],[1680161291,"892061"],[1680161292,"892061"],[1680161293,"892061"],[1680161294,"892061"],[1680161295,"892061"],[1680161296,"892061"],[1680161297,"892061"],[1680161298,"892061"],[1680161299,"892061"],[1680161300,"892061"],[1680161301,"892061"],[1680161302,"892191"],[1680161303,"892191"],[1680161304,"892191"],[1680161305,"892191"],[1680161306,"892191"],[1680161307,"892191"],[1680161308,"892191"],[1680161309,"892191"],[1680161310,"892191"],[1680161311,"892191"],[1680161312,"892191"],[1680161313,"892191"],[1680161314,"892191"],[1680161315,"892191"],[1680161316,"892191"],[1680161317,"892317"],[1680161318,"892317"],[1680161319,"892317"],[1680161320,"892317"],[1680161321,"892317"],[1680161322,"892317"],[1680161323,"892317"],[1680161324,"892317"],[1680161325,"892317"],[1680161326,"892317"],[1680161327,"892317"],[1680161328,"892317"],[1680161329,"892317"],[1680161330,"892317"],[1680161331,"892317"],[1680161332,"892449"],[1680161333,"892449"],[1680161334,"892449"],[1680161335,"892449"],[1680161336,"892449"],[1680161337,"892449"],[1680161338,"892449"],[1680161339,"892449"],[1680161340,"892449"],[1680161341,"892449"],[1680161342,"892449"],[1680161343,"892449"],[1680161344,"892449"],[1680161345,"892449"],[1680161346,"892449"],[1680161347,"892572"],[1680161348,"892572"],[1680161349,"892572"],[1680161350,"892572"],[1680161351,"892572"],[1680161352,"892572"],[1680161353,"892572"],[1680161354,"892572"],[1680161355,"892572"],[1680161356,"892572"],[1680161357,"892572"],[1680161358,"892572"],[1680161359,"892572"],[1680161360,"892572"],[1680161361,"892572"],[1680161362,"892702"],[1680161363,"892702"],[1680161364,"892702"],[1680161365,"892702"],[1680161366,"892702"],[1680161367,"892702"],[1680161368,"892702"],[1680161369,"892702"],[1680161370,"892702"],[1680161371,"892702"],[1680161372,"892702"],[1680161373,"892702"],[1680161374,"892702"],[1680161375,"892702"],[1680161376,"892702"],[1680161377,"892834"],[1680161378,"892834"],[1680161379,"892834"],[1680161380,"892834"],[1680161381,"892834"],[1680161382,"892834"],[1680161383,"892834"],[1680161384,"892834"],[1680161385,"892834"],[1680161386,"892834"],[1680161387,"892834"],[1680161388,"892834"],[1680161389,"892834"],[1680161390,"892834"],[1680161391,"892834"],[1680161392,"892963"],[1680161393,"892963"],[1680161394,"892963"],[1680161395,"892963"],[1680161396,"892963"],[1680161397,"892963"],[1680161398,"892963"],[1680161399,"892963"],[1680161400,"892963"],[1680161401,"892963"],[1680161402,"892963"],[1680161403,"892963"],[1680161404,"892963"],[1680161405,"892963"],[1680161406,"892963"],[1680161407,"893095"],[1680161408,"893095"],[1680161409,"893095"],[1680161410,"893095"],[1680161411,"893095"],[1680161412,"893095"],[1680161413,"893095"],[1680161414,"893095"],[1680161415,"893095"],[1680161416,"893095"],[1680161417,"893095"],[1680161418,"893095"],[1680161419,"893095"],[1680161420,"893095"],[1680161421,"893095"],[1680161422,"893225"],[1680161423,"893225"],[1680161424,"893225"],[1680161425,"893225"],[1680161426,"893225"],[1680161427,"893225"],[1680161428,"893225"],[1680161429,"893225"],[1680161430,"893225"],[1680161431,"893225"],[1680161432,"893225"],[1680161433,"893225"],[1680161434,"893225"],[1680161435,"893225"],[1680161436,"893225"],[1680161437,"893353"],[1680161438,"893353"],[1680161439,"893353"],[1680161440,"893353"],[1680161441,"893353"],[1680161442,"893353"],[1680161443,"893353"],[1680161444,"893353"],[1680161445,"893353"],[1680161446,"893353"],[1680161447,"893353"],[1680161448,"893353"],[1680161449,"893353"],[1680161450,"893353"],[1680161451,"893353"],[1680161452,"893481"],[1680161453,"893481"],[1680161454,"893481"],[1680161455,"893481"],[1680161456,"893481"],[1680161457,"893481"],[1680161458,"893481"],[1680161459,"893481"],[1680161460,"893481"],[1680161461,"893481"],[1680161462,"893481"],[1680161463,"893481"],[1680161464,"893481"],[1680161465,"893481"],[1680161466,"893481"],[1680161467,"893611"],[1680161468,"893611"],[1680161469,"893611"],[1680161470,"893611"],[1680161471,"893611"],[1680161472,"893611"],[1680161473,"893611"],[1680161474,"893611"],[1680161475,"893611"],[1680161476,"893611"],[1680161477,"893611"],[1680161478,"893611"],[1680161479,"893611"],[1680161480,"893611"],[1680161481,"893611"],[1680161482,"893742"],[1680161483,"893742"],[1680161484,"893742"],[1680161485,"893742"],[1680161486,"893742"],[1680161487,"893742"],[1680161488,"893742"],[1680161489,"893742"],[1680161490,"893742"],[1680161491,"893742"],[1680161492,"893742"],[1680161493,"893742"],[1680161494,"893742"],[1680161495,"893742"],[1680161496,"893742"],[1680161497,"893873"],[1680161498,"893873"],[1680161499,"893873"],[1680161500,"893873"],[1680161501,"893873"],[1680161502,"893873"],[1680161503,"893873"],[1680161504,"893873"],[1680161505,"893873"],[1680161506,"893873"],[1680161507,"893873"],[1680161508,"893873"],[1680161509,"893873"],[1680161510,"893873"],[1680161511,"893873"],[1680161512,"894000"],[1680161513,"894000"],[1680161514,"894000"],[1680161515,"894000"],[1680161516,"894000"],[1680161517,"894000"],[1680161518,"894000"],[1680161519,"894000"],[1680161520,"894000"],[1680161521,"894000"],[1680161522,"894000"],[1680161523,"894000"],[1680161524,"894000"],[1680161525,"894000"],[1680161526,"894000"],[1680161527,"894126"],[1680161528,"894126"],[1680161529,"894126"],[1680161530,"894126"],[1680161531,"894126"],[1680161532,"894126"],[1680161533,"894126"],[1680161534,"894126"],[1680161535,"894126"],[1680161536,"894126"],[1680161537,"894126"],[1680161538,"894126"],[1680161539,"894126"],[1680161540,"894126"],[1680161541,"894126"],[1680161542,"894255"],[1680161543,"894255"],[1680161544,"894255"],[1680161545,"894255"],[1680161546,"894255"],[1680161547,"894255"],[1680161548,"894255"],[1680161549,"894255"],[1680161550,"894255"],[1680161551,"894255"],[1680161552,"894255"],[1680161553,"894255"],[1680161554,"894255"],[1680161555,"894255"],[1680161556,"894255"],[1680161557,"894383"],[1680161558,"894383"],[1680161559,"894383"],[1680161560,"894383"],[1680161561,"894383"],[1680161562,"894383"],[1680161563,"894383"],[1680161564,"894383"],[1680161565,"894383"],[1680161566,"894383"],[1680161567,"894383"],[1680161568,"894383"],[1680161569,"894383"],[1680161570,"894383"],[1680161571,"894383"],[1680161572,"894514"],[1680161573,"894514"],[1680161574,"894514"],[1680161575,"894514"],[1680161576,"894514"],[1680161577,"894514"],[1680161578,"894514"],[1680161579,"894514"],[1680161580,"894514"],[1680161581,"894514"],[1680161582,"894514"],[1680161583,"894514"],[1680161584,"894514"],[1680161585,"894514"],[1680161586,"894514"],[1680161587,"894641"],[1680161588,"894641"],[1680161589,"894641"],[1680161590,"894641"],[1680161591,"894641"],[1680161592,"894641"],[1680161593,"894641"],[1680161594,"894641"],[1680161595,"894641"],[1680161596,"894641"],[1680161597,"894641"],[1680161598,"894641"],[1680161599,"894641"],[1680161600,"894641"],[1680161601,"894641"],[1680161602,"894775"],[1680161603,"894775"],[1680161604,"894775"],[1680161605,"894775"],[1680161606,"894775"],[1680161607,"894775"],[1680161608,"894775"],[1680161609,"894775"],[1680161610,"894775"],[1680161611,"894775"],[1680161612,"894775"],[1680161613,"894775"],[1680161614,"894775"],[1680161615,"894775"],[1680161616,"894775"],[1680161617,"894903"],[1680161618,"894903"],[1680161619,"894903"],[1680161620,"894903"],[1680161621,"894903"],[1680161622,"894903"],[1680161623,"894903"],[1680161624,"894903"],[1680161625,"894903"],[1680161626,"894903"],[1680161627,"894903"],[1680161628,"894903"],[1680161629,"894903"],[1680161630,"894903"],[1680161631,"894903"],[1680161632,"895032"],[1680161633,"895032"],[1680161634,"895032"],[1680161635,"895032"],[1680161636,"895032"],[1680161637,"895032"],[1680161638,"895032"],[1680161639,"895032"],[1680161640,"895032"],[1680161641,"895032"],[1680161642,"895032"],[1680161643,"895032"],[1680161644,"895032"],[1680161645,"895032"],[1680161646,"895032"],[1680161647,"895161"],[1680161648,"895161"],[1680161649,"895161"],[1680161650,"895161"],[1680161651,"895161"],[1680161652,"895161"],[1680161653,"895161"],[1680161654,"895161"],[1680161655,"895161"],[1680161656,"895161"],[1680161657,"895161"],[1680161658,"895161"],[1680161659,"895161"],[1680161660,"895161"],[1680161661,"895161"],[1680161662,"895286"],[1680161663,"895286"],[1680161664,"895286"],[1680161665,"895286"],[1680161666,"895286"],[1680161667,"895286"],[1680161668,"895286"],[1680161669,"895286"],[1680161670,"895286"],[1680161671,"895286"],[1680161672,"895286"],[1680161673,"895286"],[1680161674,"895286"],[1680161675,"895286"],[1680161676,"895286"],[1680161677,"895416"],[1680161678,"895416"],[1680161679,"895416"],[1680161680,"895416"],[1680161681,"895416"],[1680161682,"895416"],[1680161683,"895416"],[1680161684,"895416"],[1680161685,"895416"],[1680161686,"895416"],[1680161687,"895416"],[1680161688,"895416"],[1680161689,"895416"],[1680161690,"895416"],[1680161691,"895416"],[1680161692,"895549"],[1680161693,"895549"],[1680161694,"895549"],[1680161695,"895549"],[1680161696,"895549"],[1680161697,"895549"],[1680161698,"895549"],[1680161699,"895549"],[1680161700,"895549"],[1680161701,"895549"],[1680161702,"895549"],[1680161703,"895549"],[1680161704,"895549"],[1680161705,"895549"],[1680161706,"895549"],[1680161707,"895673"],[1680161708,"895673"],[1680161709,"895673"],[1680161710,"895673"],[1680161711,"895673"],[1680161712,"895673"],[1680161713,"895673"],[1680161714,"895673"],[1680161715,"895673"],[1680161716,"895673"],[1680161717,"895673"],[1680161718,"895673"],[1680161719,"895673"],[1680161720,"895673"],[1680161721,"895673"],[1680161722,"895803"],[1680161723,"895803"],[1680161724,"895803"],[1680161725,"895803"],[1680161726,"895803"],[1680161727,"895803"],[1680161728,"895803"],[1680161729,"895803"],[1680161730,"895803"],[1680161731,"895803"],[1680161732,"895803"],[1680161733,"895803"],[1680161734,"895803"],[1680161735,"895803"],[1680161736,"895803"],[1680161737,"895929"],[1680161738,"895929"],[1680161739,"895929"],[1680161740,"895929"],[1680161741,"895929"],[1680161742,"895929"],[1680161743,"895929"],[1680161744,"895929"],[1680161745,"895929"],[1680161746,"895929"],[1680161747,"895929"],[1680161748,"895929"],[1680161749,"895929"],[1680161750,"895929"],[1680161751,"895929"],[1680161752,"896064"],[1680161753,"896064"],[1680161754,"896064"],[1680161755,"896064"],[1680161756,"896064"],[1680161757,"896064"],[1680161758,"896064"],[1680161759,"896064"],[1680161760,"896064"],[1680161761,"896064"],[1680161762,"896064"],[1680161763,"896064"],[1680161764,"896064"],[1680161765,"896064"],[1680161766,"896064"],[1680161767,"896189"],[1680161768,"896189"],[1680161769,"896189"],[1680161770,"896189"],[1680161771,"896189"],[1680161772,"896189"],[1680161773,"896189"],[1680161774,"896189"],[1680161775,"896189"],[1680161776,"896189"],[1680161777,"896189"],[1680161778,"896189"],[1680161779,"896189"],[1680161780,"896189"],[1680161781,"896189"],[1680161782,"896323"],[1680161783,"896323"],[1680161784,"896323"],[1680161785,"896323"],[1680161786,"896323"],[1680161787,"896323"],[1680161788,"896323"],[1680161789,"896323"],[1680161790,"896323"],[1680161791,"896323"],[1680161792,"896323"],[1680161793,"896323"],[1680161794,"896323"],[1680161795,"896323"],[1680161796,"896323"],[1680161797,"896449"],[1680161798,"896449"],[1680161799,"896449"],[1680161800,"896449"],[1680161801,"896449"],[1680161802,"896449"],[1680161803,"896449"],[1680161804,"896449"],[1680161805,"896449"],[1680161806,"896449"],[1680161807,"896449"],[1680161808,"896449"],[1680161809,"896449"],[1680161810,"896449"],[1680161811,"896449"],[1680161812,"896579"],[1680161813,"896579"],[1680161814,"896579"],[1680161815,"896579"],[1680161816,"896579"],[1680161817,"896579"],[1680161818,"896579"],[1680161819,"896579"],[1680161820,"896579"],[1680161821,"896579"],[1680161822,"896579"],[1680161823,"896579"],[1680161824,"896579"],[1680161825,"896579"],[1680161826,"896579"],[1680161827,"896702"],[1680161828,"896702"],[1680161829,"896702"],[1680161830,"896702"],[1680161831,"896702"],[1680161832,"896702"],[1680161833,"896702"],[1680161834,"896702"],[1680161835,"896702"],[1680161836,"896702"],[1680161837,"896702"],[1680161838,"896702"],[1680161839,"896702"],[1680161840,"896702"],[1680161841,"896702"],[1680161842,"896832"],[1680161843,"896832"],[1680161844,"896832"],[1680161845,"896832"],[1680161846,"896832"],[1680161847,"896832"],[1680161848,"896832"],[1680161849,"896832"],[1680161850,"896832"],[1680161851,"896832"],[1680161852,"896832"],[1680161853,"896832"],[1680161854,"896832"],[1680161855,"896832"],[1680161856,"896832"],[1680161857,"896962"],[1680161858,"896962"],[1680161859,"896962"],[1680161860,"896962"],[1680161861,"896962"],[1680161862,"896962"],[1680161863,"896962"],[1680161864,"896962"],[1680161865,"896962"],[1680161866,"896962"],[1680161867,"896962"],[1680161868,"896962"],[1680161869,"896962"],[1680161870,"896962"],[1680161871,"896962"],[1680161872,"897121"],[1680161873,"897121"],[1680161874,"897121"],[1680161875,"897121"],[1680161876,"897121"],[1680161877,"897121"],[1680161878,"897121"],[1680161879,"897121"],[1680161880,"897121"],[1680161881,"897121"],[1680161882,"897121"],[1680161883,"897121"],[1680161884,"897121"],[1680161885,"897121"],[1680161886,"897121"],[1680161887,"897267"],[1680161888,"897267"],[1680161889,"897267"],[1680161890,"897267"],[1680161891,"897267"],[1680161892,"897267"],[1680161893,"897267"],[1680161894,"897267"],[1680161895,"897267"],[1680161896,"897267"],[1680161897,"897267"],[1680161898,"897267"],[1680161899,"897267"],[1680161900,"897267"],[1680161901,"897267"],[1680161902,"897426"],[1680161903,"897426"],[1680161904,"897426"],[1680161905,"897426"],[1680161906,"897426"],[1680161907,"897426"],[1680161908,"897426"],[1680161909,"897426"],[1680161910,"897426"],[1680161911,"897426"],[1680161912,"897426"],[1680161913,"897426"],[1680161914,"897426"],[1680161915,"897426"],[1680161916,"897426"],[1680161917,"897586"],[1680161918,"897586"],[1680161919,"897586"],[1680161920,"897586"],[1680161921,"897586"],[1680161922,"897586"],[1680161923,"897586"],[1680161924,"897586"],[1680161925,"897586"],[1680161926,"897586"],[1680161927,"897586"],[1680161928,"897586"],[1680161929,"897586"],[1680161930,"897586"],[1680161931,"897586"],[1680161932,"897750"],[1680161933,"897750"],[1680161934,"897750"],[1680161935,"897750"],[1680161936,"897750"],[1680161937,"897750"],[1680161938,"897750"],[1680161939,"897750"],[1680161940,"897750"],[1680161941,"897750"],[1680161942,"897750"],[1680161943,"897750"],[1680161944,"897750"],[1680161945,"897750"],[1680161946,"897750"],[1680161947,"897910"],[1680161948,"897910"],[1680161949,"897910"],[1680161950,"897910"],[1680161951,"897910"],[1680161952,"897910"],[1680161953,"897910"],[1680161954,"897910"],[1680161955,"897910"],[1680161956,"897910"],[1680161957,"897910"],[1680161958,"897910"],[1680161959,"897910"],[1680161960,"897910"],[1680161961,"897910"],[1680161962,"898072"],[1680161963,"898072"],[1680161964,"898072"],[1680161965,"898072"],[1680161966,"898072"],[1680161967,"898072"],[1680161968,"898072"],[1680161969,"898072"],[1680161970,"898072"],[1680161971,"898072"],[1680161972,"898072"],[1680161973,"898072"],[1680161974,"898072"],[1680161975,"898072"],[1680161976,"898072"],[1680161977,"898210"],[1680161978,"898210"],[1680161979,"898210"],[1680161980,"898210"],[1680161981,"898210"],[1680161982,"898210"],[1680161983,"898210"],[1680161984,"898210"],[1680161985,"898210"],[1680161986,"898210"],[1680161987,"898210"],[1680161988,"898210"],[1680161989,"898210"],[1680161990,"898210"],[1680161991,"898210"],[1680161992,"898338"],[1680161993,"898338"],[1680161994,"898338"],[1680161995,"898338"],[1680161996,"898338"],[1680161997,"898338"],[1680161998,"898338"],[1680161999,"898338"],[1680162000,"898338"],[1680162001,"898338"],[1680162002,"898338"],[1680162003,"898338"],[1680162004,"898338"],[1680162005,"898338"],[1680162006,"898338"],[1680162007,"898467"],[1680162008,"898467"],[1680162009,"898467"],[1680162010,"898467"],[1680162011,"898467"],[1680162012,"898467"],[1680162013,"898467"],[1680162014,"898467"],[1680162015,"898467"],[1680162016,"898467"],[1680162017,"898467"],[1680162018,"898467"],[1680162019,"898467"],[1680162020,"898467"],[1680162021,"898467"],[1680162022,"898599"],[1680162023,"898599"],[1680162024,"898599"],[1680162025,"898599"],[1680162026,"898599"],[1680162027,"898599"],[1680162028,"898599"],[1680162029,"898599"],[1680162030,"898599"],[1680162031,"898599"],[1680162032,"898599"],[1680162033,"898599"],[1680162034,"898599"],[1680162035,"898599"],[1680162036,"898599"],[1680162037,"898730"],[1680162038,"898730"],[1680162039,"898730"],[1680162040,"898730"],[1680162041,"898730"],[1680162042,"898730"],[1680162043,"898730"],[1680162044,"898730"],[1680162045,"898730"],[1680162046,"898730"],[1680162047,"898730"],[1680162048,"898730"],[1680162049,"898730"],[1680162050,"898730"],[1680162051,"898730"],[1680162052,"898859"],[1680162053,"898859"],[1680162054,"898859"],[1680162055,"898859"],[1680162056,"898859"],[1680162057,"898859"],[1680162058,"898859"],[1680162059,"898859"],[1680162060,"898859"],[1680162061,"898859"],[1680162062,"898859"],[1680162063,"898859"],[1680162064,"898859"],[1680162065,"898859"],[1680162066,"898859"],[1680162067,"898988"],[1680162068,"898988"],[1680162069,"898988"],[1680162070,"898988"],[1680162071,"898988"],[1680162072,"898988"],[1680162073,"898988"],[1680162074,"898988"],[1680162075,"898988"],[1680162076,"898988"],[1680162077,"898988"],[1680162078,"898988"],[1680162079,"898988"],[1680162080,"898988"],[1680162081,"898988"],[1680162082,"899120"],[1680162083,"899120"],[1680162084,"899120"],[1680162085,"899120"],[1680162086,"899120"],[1680162087,"899120"],[1680162088,"899120"],[1680162089,"899120"],[1680162090,"899120"],[1680162091,"899120"],[1680162092,"899120"],[1680162093,"899120"],[1680162094,"899120"],[1680162095,"899120"],[1680162096,"899120"],[1680162097,"899248"],[1680162098,"899248"],[1680162099,"899248"],[1680162100,"899248"],[1680162101,"899248"],[1680162102,"899248"],[1680162103,"899248"],[1680162104,"899248"],[1680162105,"899248"],[1680162106,"899248"],[1680162107,"899248"],[1680162108,"899248"],[1680162109,"899248"],[1680162110,"899248"],[1680162111,"899248"],[1680162112,"899374"],[1680162113,"899374"],[1680162114,"899374"],[1680162115,"899374"],[1680162116,"899374"],[1680162117,"899374"],[1680162118,"899374"],[1680162119,"899374"],[1680162120,"899374"],[1680162121,"899374"],[1680162122,"899374"],[1680162123,"899374"],[1680162124,"899374"],[1680162125,"899374"],[1680162126,"899374"],[1680162127,"899495"],[1680162128,"899495"],[1680162129,"899495"],[1680162130,"899495"],[1680162131,"899495"],[1680162132,"899495"],[1680162133,"899495"],[1680162134,"899495"],[1680162135,"899495"],[1680162136,"899495"],[1680162137,"899495"],[1680162138,"899495"],[1680162139,"899495"],[1680162140,"899495"],[1680162141,"899495"],[1680162142,"899605"],[1680162143,"899605"],[1680162144,"899605"],[1680162145,"899605"],[1680162146,"899605"],[1680162147,"899605"],[1680162148,"899605"],[1680162149,"899605"],[1680162150,"899605"],[1680162151,"899605"],[1680162152,"899605"],[1680162153,"899605"],[1680162154,"899605"],[1680162155,"899605"],[1680162156,"899605"],[1680162157,"899725"],[1680162158,"899725"],[1680162159,"899725"],[1680162160,"899725"],[1680162161,"899725"],[1680162162,"899725"],[1680162163,"899725"],[1680162164,"899725"],[1680162165,"899725"],[1680162166,"899725"],[1680162167,"899725"],[1680162168,"899725"],[1680162169,"899725"],[1680162170,"899725"],[1680162171,"899725"],[1680162172,"899842"],[1680162173,"899842"],[1680162174,"899842"],[1680162175,"899842"],[1680162176,"899842"],[1680162177,"899842"],[1680162178,"899842"],[1680162179,"899842"],[1680162180,"899842"],[1680162181,"899842"],[1680162182,"899842"],[1680162183,"899842"],[1680162184,"899842"],[1680162185,"899842"],[1680162186,"899842"],[1680162187,"899975"],[1680162188,"899975"],[1680162189,"899975"],[1680162190,"899975"],[1680162191,"899975"],[1680162192,"899975"],[1680162193,"899975"],[1680162194,"899975"],[1680162195,"899975"],[1680162196,"899975"],[1680162197,"899975"],[1680162198,"899975"],[1680162199,"899975"],[1680162200,"899975"],[1680162201,"899975"],[1680162202,"900108"],[1680162203,"900108"],[1680162204,"900108"],[1680162205,"900108"],[1680162206,"900108"],[1680162207,"900108"],[1680162208,"900108"],[1680162209,"900108"],[1680162210,"900108"],[1680162211,"900108"],[1680162212,"900108"],[1680162213,"900108"],[1680162214,"900108"],[1680162215,"900108"],[1680162216,"900108"],[1680162217,"900234"],[1680162218,"900234"],[1680162219,"900234"],[1680162220,"900234"],[1680162221,"900234"],[1680162222,"900234"],[1680162223,"900234"],[1680162224,"900234"],[1680162225,"900234"],[1680162226,"900234"],[1680162227,"900234"],[1680162228,"900234"],[1680162229,"900234"],[1680162230,"900234"],[1680162231,"900234"],[1680162232,"900360"],[1680162233,"900360"],[1680162234,"900360"],[1680162235,"900360"],[1680162236,"900360"],[1680162237,"900360"],[1680162238,"900360"],[1680162239,"900360"],[1680162240,"900360"],[1680162241,"900360"],[1680162242,"900360"],[1680162243,"900360"],[1680162244,"900360"],[1680162245,"900360"],[1680162246,"900360"],[1680162247,"900484"],[1680162248,"900484"],[1680162249,"900484"],[1680162250,"900484"],[1680162251,"900484"],[1680162252,"900484"],[1680162253,"900484"],[1680162254,"900484"],[1680162255,"900484"],[1680162256,"900484"],[1680162257,"900484"],[1680162258,"900484"],[1680162259,"900484"],[1680162260,"900484"],[1680162261,"900484"],[1680162262,"900614"],[1680162263,"900614"],[1680162264,"900614"],[1680162265,"900614"],[1680162266,"900614"],[1680162267,"900614"],[1680162268,"900614"],[1680162269,"900614"],[1680162270,"900614"],[1680162271,"900614"],[1680162272,"900614"],[1680162273,"900614"],[1680162274,"900614"],[1680162275,"900614"],[1680162276,"900614"],[1680162277,"900745"],[1680162278,"900745"],[1680162279,"900745"],[1680162280,"900745"],[1680162281,"900745"],[1680162282,"900745"],[1680162283,"900745"],[1680162284,"900745"],[1680162285,"900745"],[1680162286,"900745"],[1680162287,"900745"],[1680162288,"900745"],[1680162289,"900745"],[1680162290,"900745"],[1680162291,"900745"],[1680162292,"900874"],[1680162293,"900874"],[1680162294,"900874"],[1680162295,"900874"],[1680162296,"900874"],[1680162297,"900874"],[1680162298,"900874"],[1680162299,"900874"],[1680162300,"900874"],[1680162301,"900874"],[1680162302,"900874"],[1680162303,"900874"],[1680162304,"900874"],[1680162305,"900874"],[1680162306,"900874"],[1680162307,"900998"],[1680162308,"900998"],[1680162309,"900998"],[1680162310,"900998"],[1680162311,"900998"],[1680162312,"900998"],[1680162313,"900998"],[1680162314,"900998"],[1680162315,"900998"],[1680162316,"900998"],[1680162317,"900998"],[1680162318,"900998"],[1680162319,"900998"],[1680162320,"900998"],[1680162321,"900998"],[1680162322,"901129"],[1680162323,"901129"],[1680162324,"901129"],[1680162325,"901129"],[1680162326,"901129"],[1680162327,"901129"],[1680162328,"901129"],[1680162329,"901129"],[1680162330,"901129"],[1680162331,"901129"],[1680162332,"901129"],[1680162333,"901129"],[1680162334,"901129"],[1680162335,"901129"],[1680162336,"901129"],[1680162337,"901260"],[1680162338,"901260"],[1680162339,"901260"],[1680162340,"901260"],[1680162341,"901260"],[1680162342,"901260"],[1680162343,"901260"],[1680162344,"901260"],[1680162345,"901260"],[1680162346,"901260"],[1680162347,"901260"],[1680162348,"901260"],[1680162349,"901260"],[1680162350,"901260"],[1680162351,"901260"],[1680162352,"901390"],[1680162353,"901390"],[1680162354,"901390"],[1680162355,"901390"],[1680162356,"901390"],[1680162357,"901390"],[1680162358,"901390"],[1680162359,"901390"],[1680162360,"901390"],[1680162361,"901390"],[1680162362,"901390"],[1680162363,"901390"],[1680162364,"901390"],[1680162365,"901390"],[1680162366,"901390"],[1680162367,"901518"],[1680162368,"901518"],[1680162369,"901518"],[1680162370,"901518"],[1680162371,"901518"],[1680162372,"901518"],[1680162373,"901518"],[1680162374,"901518"],[1680162375,"901518"],[1680162376,"901518"],[1680162377,"901518"],[1680162378,"901518"],[1680162379,"901518"],[1680162380,"901518"],[1680162381,"901518"],[1680162382,"901645"],[1680162383,"901645"],[1680162384,"901645"],[1680162385,"901645"],[1680162386,"901645"],[1680162387,"901645"],[1680162388,"901645"],[1680162389,"901645"],[1680162390,"901645"],[1680162391,"901645"],[1680162392,"901645"],[1680162393,"901645"],[1680162394,"901645"],[1680162395,"901645"],[1680162396,"901645"],[1680162397,"901778"],[1680162398,"901778"],[1680162399,"901778"],[1680162400,"901778"],[1680162401,"901778"],[1680162402,"901778"],[1680162403,"901778"],[1680162404,"901778"],[1680162405,"901778"],[1680162406,"901778"],[1680162407,"901778"],[1680162408,"901778"],[1680162409,"901778"],[1680162410,"901778"],[1680162411,"901778"],[1680162412,"901905"],[1680162413,"901905"],[1680162414,"901905"],[1680162415,"901905"],[1680162416,"901905"],[1680162417,"901905"],[1680162418,"901905"],[1680162419,"901905"],[1680162420,"901905"],[1680162421,"901905"],[1680162422,"901905"],[1680162423,"901905"],[1680162424,"901905"],[1680162425,"901905"],[1680162426,"901905"],[1680162427,"902031"],[1680162428,"902031"],[1680162429,"902031"],[1680162430,"902031"],[1680162431,"902031"],[1680162432,"902031"],[1680162433,"902031"],[1680162434,"902031"],[1680162435,"902031"],[1680162436,"902031"],[1680162437,"902031"],[1680162438,"902031"],[1680162439,"902031"],[1680162440,"902031"],[1680162441,"902031"],[1680162442,"902161"],[1680162443,"902161"],[1680162444,"902161"],[1680162445,"902161"],[1680162446,"902161"],[1680162447,"902161"],[1680162448,"902161"],[1680162449,"902161"],[1680162450,"902161"],[1680162451,"902161"],[1680162452,"902161"],[1680162453,"902161"],[1680162454,"902161"],[1680162455,"902161"],[1680162456,"902161"],[1680162457,"902291"],[1680162458,"902291"],[1680162459,"902291"],[1680162460,"902291"],[1680162461,"902291"],[1680162462,"902291"],[1680162463,"902291"],[1680162464,"902291"],[1680162465,"902291"],[1680162466,"902291"],[1680162467,"902291"],[1680162468,"902291"],[1680162469,"902291"],[1680162470,"902291"],[1680162471,"902291"],[1680162472,"902420"],[1680162473,"902420"],[1680162474,"902420"],[1680162475,"902420"],[1680162476,"902420"],[1680162477,"902420"],[1680162478,"902420"],[1680162479,"902420"],[1680162480,"902420"],[1680162481,"902420"],[1680162482,"902420"],[1680162483,"902420"],[1680162484,"902420"],[1680162485,"902420"],[1680162486,"902420"],[1680162487,"902548"],[1680162488,"902548"],[1680162489,"902548"],[1680162490,"902548"],[1680162491,"902548"],[1680162492,"902548"],[1680162493,"902548"],[1680162494,"902548"],[1680162495,"902548"],[1680162496,"902548"],[1680162497,"902548"],[1680162498,"902548"],[1680162499,"902548"],[1680162500,"902548"],[1680162501,"902548"],[1680162502,"902675"],[1680162503,"902675"],[1680162504,"902675"],[1680162505,"902675"],[1680162506,"902675"],[1680162507,"902675"],[1680162508,"902675"],[1680162509,"902675"],[1680162510,"902675"],[1680162511,"902675"],[1680162512,"902675"],[1680162513,"902675"],[1680162514,"902675"],[1680162515,"902675"],[1680162516,"902675"],[1680162517,"902802"],[1680162518,"902802"],[1680162519,"902802"],[1680162520,"902802"],[1680162521,"902802"],[1680162522,"902802"],[1680162523,"902802"],[1680162524,"902802"],[1680162525,"902802"],[1680162526,"902802"],[1680162527,"902802"],[1680162528,"902802"],[1680162529,"902802"],[1680162530,"902802"],[1680162531,"902802"],[1680162532,"902934"],[1680162533,"902934"],[1680162534,"902934"],[1680162535,"902934"],[1680162536,"902934"],[1680162537,"902934"],[1680162538,"902934"],[1680162539,"902934"],[1680162540,"902934"],[1680162541,"902934"],[1680162542,"902934"],[1680162543,"902934"],[1680162544,"902934"],[1680162545,"902934"],[1680162546,"902934"],[1680162547,"903060"],[1680162548,"903060"],[1680162549,"903060"],[1680162550,"903060"],[1680162551,"903060"],[1680162552,"903060"],[1680162553,"903060"],[1680162554,"903060"],[1680162555,"903060"],[1680162556,"903060"],[1680162557,"903060"],[1680162558,"903060"],[1680162559,"903060"],[1680162560,"903060"],[1680162561,"903060"],[1680162562,"903189"],[1680162563,"903189"],[1680162564,"903189"],[1680162565,"903189"],[1680162566,"903189"],[1680162567,"903189"],[1680162568,"903189"],[1680162569,"903189"],[1680162570,"903189"],[1680162571,"903189"],[1680162572,"903189"],[1680162573,"903189"],[1680162574,"903189"],[1680162575,"903189"],[1680162576,"903189"],[1680162577,"903318"],[1680162578,"903318"],[1680162579,"903318"],[1680162580,"903318"],[1680162581,"903318"],[1680162582,"903318"],[1680162583,"903318"],[1680162584,"903318"],[1680162585,"903318"],[1680162586,"903318"],[1680162587,"903318"],[1680162588,"903318"],[1680162589,"903318"],[1680162590,"903318"],[1680162591,"903318"],[1680162592,"903450"],[1680162593,"903450"],[1680162594,"903450"],[1680162595,"903450"],[1680162596,"903450"],[1680162597,"903450"],[1680162598,"903450"],[1680162599,"903450"],[1680162600,"903450"],[1680162601,"903450"],[1680162602,"903450"],[1680162603,"903450"],[1680162604,"903450"],[1680162605,"903450"],[1680162606,"903450"],[1680162607,"903573"],[1680162608,"903573"],[1680162609,"903573"],[1680162610,"903573"],[1680162611,"903573"],[1680162612,"903573"],[1680162613,"903573"],[1680162614,"903573"],[1680162615,"903573"],[1680162616,"903573"],[1680162617,"903573"],[1680162618,"903573"],[1680162619,"903573"],[1680162620,"903573"],[1680162621,"903573"],[1680162622,"903684"],[1680162623,"903684"],[1680162624,"903684"],[1680162625,"903684"],[1680162626,"903684"],[1680162627,"903684"],[1680162628,"903684"],[1680162629,"903684"],[1680162630,"903684"],[1680162631,"903684"],[1680162632,"903684"],[1680162633,"903684"],[1680162634,"903684"],[1680162635,"903684"],[1680162636,"903684"],[1680162637,"903802"],[1680162638,"903802"],[1680162639,"903802"],[1680162640,"903802"],[1680162641,"903802"],[1680162642,"903802"],[1680162643,"903802"],[1680162644,"903802"],[1680162645,"903802"],[1680162646,"903802"],[1680162647,"903802"],[1680162648,"903802"],[1680162649,"903802"],[1680162650,"903802"],[1680162651,"903802"],[1680162652,"903921"],[1680162653,"903921"],[1680162654,"903921"],[1680162655,"903921"],[1680162656,"903921"],[1680162657,"903921"],[1680162658,"903921"],[1680162659,"903921"],[1680162660,"903921"],[1680162661,"903921"],[1680162662,"903921"],[1680162663,"903921"],[1680162664,"903921"],[1680162665,"903921"],[1680162666,"903921"],[1680162667,"904052"],[1680162668,"904052"],[1680162669,"904052"],[1680162670,"904052"],[1680162671,"904052"],[1680162672,"904052"],[1680162673,"904052"],[1680162674,"904052"],[1680162675,"904052"],[1680162676,"904052"],[1680162677,"904052"],[1680162678,"904052"],[1680162679,"904052"],[1680162680,"904052"],[1680162681,"904052"],[1680162682,"904180"],[1680162683,"904180"],[1680162684,"904180"],[1680162685,"904180"],[1680162686,"904180"],[1680162687,"904180"],[1680162688,"904180"],[1680162689,"904180"],[1680162690,"904180"],[1680162691,"904180"],[1680162692,"904180"],[1680162693,"904180"],[1680162694,"904180"],[1680162695,"904180"],[1680162696,"904180"],[1680162697,"904314"],[1680162698,"904314"],[1680162699,"904314"],[1680162700,"904314"],[1680162701,"904314"],[1680162702,"904314"],[1680162703,"904314"],[1680162704,"904314"],[1680162705,"904314"],[1680162706,"904314"],[1680162707,"904314"],[1680162708,"904314"],[1680162709,"904314"],[1680162710,"904314"],[1680162711,"904314"],[1680162712,"904441"],[1680162713,"904441"],[1680162714,"904441"],[1680162715,"904441"],[1680162716,"904441"],[1680162717,"904441"],[1680162718,"904441"],[1680162719,"904441"],[1680162720,"904441"],[1680162721,"904441"],[1680162722,"904441"],[1680162723,"904441"],[1680162724,"904441"],[1680162725,"904441"],[1680162726,"904441"],[1680162727,"904566"],[1680162728,"904566"],[1680162729,"904566"],[1680162730,"904566"],[1680162731,"904566"],[1680162732,"904566"],[1680162733,"904566"],[1680162734,"904566"],[1680162735,"904566"],[1680162736,"904566"],[1680162737,"904566"],[1680162738,"904566"],[1680162739,"904566"],[1680162740,"904566"],[1680162741,"904566"],[1680162742,"904698"],[1680162743,"904698"],[1680162744,"904698"],[1680162745,"904698"],[1680162746,"904698"],[1680162747,"904698"],[1680162748,"904698"],[1680162749,"904698"],[1680162750,"904698"],[1680162751,"904698"],[1680162752,"904698"],[1680162753,"904698"],[1680162754,"904698"],[1680162755,"904698"],[1680162756,"904698"],[1680162757,"904827"],[1680162758,"904827"],[1680162759,"904827"],[1680162760,"904827"],[1680162761,"904827"],[1680162762,"904827"],[1680162763,"904827"],[1680162764,"904827"],[1680162765,"904827"],[1680162766,"904827"],[1680162767,"904827"],[1680162768,"904827"],[1680162769,"904827"],[1680162770,"904827"],[1680162771,"904827"],[1680162772,"904957"],[1680162773,"904957"],[1680162774,"904957"],[1680162775,"904957"],[1680162776,"904957"],[1680162777,"904957"],[1680162778,"904957"],[1680162779,"904957"],[1680162780,"904957"],[1680162781,"904957"],[1680162782,"904957"],[1680162783,"904957"],[1680162784,"904957"],[1680162785,"904957"],[1680162786,"904957"],[1680162787,"905082"],[1680162788,"905082"],[1680162789,"905082"],[1680162790,"905082"],[1680162791,"905082"],[1680162792,"905082"],[1680162793,"905082"],[1680162794,"905082"],[1680162795,"905082"],[1680162796,"905082"],[1680162797,"905082"],[1680162798,"905082"],[1680162799,"905082"],[1680162800,"905082"],[1680162801,"905082"],[1680162802,"905212"],[1680162803,"905212"],[1680162804,"905212"],[1680162805,"905212"],[1680162806,"905212"],[1680162807,"905212"],[1680162808,"905212"],[1680162809,"905212"],[1680162810,"905212"],[1680162811,"905212"],[1680162812,"905212"],[1680162813,"905212"],[1680162814,"905212"],[1680162815,"905212"],[1680162816,"905212"],[1680162817,"905339"],[1680162818,"905339"],[1680162819,"905339"],[1680162820,"905339"],[1680162821,"905339"],[1680162822,"905339"],[1680162823,"905339"],[1680162824,"905339"],[1680162825,"905339"],[1680162826,"905339"],[1680162827,"905339"],[1680162828,"905339"],[1680162829,"905339"],[1680162830,"905339"],[1680162831,"905339"],[1680162832,"905468"],[1680162833,"905468"],[1680162834,"905468"],[1680162835,"905468"],[1680162836,"905468"],[1680162837,"905468"],[1680162838,"905468"],[1680162839,"905468"],[1680162840,"905468"],[1680162841,"905468"],[1680162842,"905468"],[1680162843,"905468"],[1680162844,"905468"],[1680162845,"905468"],[1680162846,"905468"],[1680162847,"905593"],[1680162848,"905593"],[1680162849,"905593"],[1680162850,"905593"],[1680162851,"905593"],[1680162852,"905593"],[1680162853,"905593"],[1680162854,"905593"],[1680162855,"905593"],[1680162856,"905593"],[1680162857,"905593"],[1680162858,"905593"],[1680162859,"905593"],[1680162860,"905593"],[1680162861,"905593"],[1680162862,"905722"],[1680162863,"905722"],[1680162864,"905722"],[1680162865,"905722"],[1680162866,"905722"],[1680162867,"905722"],[1680162868,"905722"],[1680162869,"905722"],[1680162870,"905722"],[1680162871,"905722"],[1680162872,"905722"],[1680162873,"905722"],[1680162874,"905722"],[1680162875,"905722"],[1680162876,"905722"],[1680162877,"905853"],[1680162878,"905853"],[1680162879,"905853"],[1680162880,"905853"],[1680162881,"905853"],[1680162882,"905853"],[1680162883,"905853"],[1680162884,"905853"],[1680162885,"905853"],[1680162886,"905853"],[1680162887,"905853"],[1680162888,"905853"],[1680162889,"905853"],[1680162890,"905853"],[1680162891,"905853"],[1680162892,"905981"],[1680162893,"905981"],[1680162894,"905981"],[1680162895,"905981"],[1680162896,"905981"],[1680162897,"905981"],[1680162898,"905981"],[1680162899,"905981"],[1680162900,"905981"],[1680162901,"905981"],[1680162902,"905981"],[1680162903,"905981"],[1680162904,"905981"],[1680162905,"905981"],[1680162906,"905981"],[1680162907,"906108"],[1680162908,"906108"],[1680162909,"906108"],[1680162910,"906108"],[1680162911,"906108"],[1680162912,"906108"],[1680162913,"906108"],[1680162914,"906108"],[1680162915,"906108"],[1680162916,"906108"],[1680162917,"906108"],[1680162918,"906108"],[1680162919,"906108"],[1680162920,"906108"],[1680162921,"906108"],[1680162922,"906234"],[1680162923,"906234"],[1680162924,"906234"],[1680162925,"906234"],[1680162926,"906234"],[1680162927,"906234"],[1680162928,"906234"],[1680162929,"906234"],[1680162930,"906234"],[1680162931,"906234"],[1680162932,"906234"],[1680162933,"906234"],[1680162934,"906234"],[1680162935,"906234"],[1680162936,"906234"],[1680162937,"906364"],[1680162938,"906364"],[1680162939,"906364"],[1680162940,"906364"],[1680162941,"906364"],[1680162942,"906364"],[1680162943,"906364"],[1680162944,"906364"],[1680162945,"906364"],[1680162946,"906364"],[1680162947,"906364"],[1680162948,"906364"],[1680162949,"906364"],[1680162950,"906364"],[1680162951,"906364"],[1680162952,"906495"],[1680162953,"906495"],[1680162954,"906495"],[1680162955,"906495"],[1680162956,"906495"],[1680162957,"906495"],[1680162958,"906495"],[1680162959,"906495"],[1680162960,"906495"],[1680162961,"906495"],[1680162962,"906495"],[1680162963,"906495"],[1680162964,"906495"],[1680162965,"906495"],[1680162966,"906495"],[1680162967,"906623"],[1680162968,"906623"],[1680162969,"906623"],[1680162970,"906623"],[1680162971,"906623"],[1680162972,"906623"],[1680162973,"906623"],[1680162974,"906623"],[1680162975,"906623"],[1680162976,"906623"],[1680162977,"906623"],[1680162978,"906623"],[1680162979,"906623"],[1680162980,"906623"],[1680162981,"906623"],[1680162982,"906754"],[1680162983,"906754"],[1680162984,"906754"],[1680162985,"906754"],[1680162986,"906754"],[1680162987,"906754"],[1680162988,"906754"],[1680162989,"906754"],[1680162990,"906754"],[1680162991,"906754"],[1680162992,"906754"],[1680162993,"906754"],[1680162994,"906754"],[1680162995,"906754"],[1680162996,"906754"],[1680162997,"906881"],[1680162998,"906881"],[1680162999,"906881"],[1680163000,"906881"],[1680163001,"906881"],[1680163002,"906881"],[1680163003,"906881"],[1680163004,"906881"],[1680163005,"906881"],[1680163006,"906881"],[1680163007,"906881"],[1680163008,"906881"],[1680163009,"906881"],[1680163010,"906881"],[1680163011,"906881"],[1680163012,"907010"],[1680163013,"907010"],[1680163014,"907010"],[1680163015,"907010"],[1680163016,"907010"],[1680163017,"907010"],[1680163018,"907010"],[1680163019,"907010"],[1680163020,"907010"],[1680163021,"907010"],[1680163022,"907010"],[1680163023,"907010"],[1680163024,"907010"],[1680163025,"907010"],[1680163026,"907010"],[1680163027,"907140"],[1680163028,"907140"],[1680163029,"907140"],[1680163030,"907140"],[1680163031,"907140"],[1680163032,"907140"],[1680163033,"907140"],[1680163034,"907140"],[1680163035,"907140"],[1680163036,"907140"],[1680163037,"907140"],[1680163038,"907140"],[1680163039,"907140"],[1680163040,"907140"],[1680163041,"907140"],[1680163042,"907269"],[1680163043,"907269"],[1680163044,"907269"],[1680163045,"907269"],[1680163046,"907269"],[1680163047,"907269"],[1680163048,"907269"],[1680163049,"907269"],[1680163050,"907269"],[1680163051,"907269"],[1680163052,"907269"],[1680163053,"907269"],[1680163054,"907269"],[1680163055,"907269"],[1680163056,"907269"],[1680163057,"907398"],[1680163058,"907398"],[1680163059,"907398"],[1680163060,"907398"],[1680163061,"907398"],[1680163062,"907398"],[1680163063,"907398"],[1680163064,"907398"],[1680163065,"907398"],[1680163066,"907398"],[1680163067,"907398"],[1680163068,"907398"],[1680163069,"907398"],[1680163070,"907398"],[1680163071,"907398"],[1680163072,"907527"],[1680163073,"907527"],[1680163074,"907527"],[1680163075,"907527"],[1680163076,"907527"],[1680163077,"907527"],[1680163078,"907527"],[1680163079,"907527"],[1680163080,"907527"],[1680163081,"907527"],[1680163082,"907527"],[1680163083,"907527"],[1680163084,"907527"],[1680163085,"907527"],[1680163086,"907527"],[1680163087,"907654"],[1680163088,"907654"],[1680163089,"907654"],[1680163090,"907654"],[1680163091,"907654"],[1680163092,"907654"],[1680163093,"907654"],[1680163094,"907654"],[1680163095,"907654"],[1680163096,"907654"],[1680163097,"907654"],[1680163098,"907654"],[1680163099,"907654"],[1680163100,"907654"],[1680163101,"907654"],[1680163102,"907782"],[1680163103,"907782"],[1680163104,"907782"],[1680163105,"907782"],[1680163106,"907782"],[1680163107,"907782"],[1680163108,"907782"],[1680163109,"907782"],[1680163110,"907782"],[1680163111,"907782"],[1680163112,"907782"],[1680163113,"907782"],[1680163114,"907782"],[1680163115,"907782"],[1680163116,"907782"],[1680163117,"907914"],[1680163118,"907914"],[1680163119,"907914"],[1680163120,"907914"],[1680163121,"907914"],[1680163122,"907914"],[1680163123,"907914"],[1680163124,"907914"],[1680163125,"907914"],[1680163126,"907914"],[1680163127,"907914"],[1680163128,"907914"],[1680163129,"907914"],[1680163130,"907914"],[1680163131,"907914"],[1680163132,"908041"],[1680163133,"908041"],[1680163134,"908041"],[1680163135,"908041"],[1680163136,"908041"],[1680163137,"908041"],[1680163138,"908041"],[1680163139,"908041"],[1680163140,"908041"],[1680163141,"908041"],[1680163142,"908041"],[1680163143,"908041"],[1680163144,"908041"],[1680163145,"908041"],[1680163146,"908041"],[1680163147,"908169"],[1680163148,"908169"],[1680163149,"908169"],[1680163150,"908169"],[1680163151,"908169"],[1680163152,"908169"],[1680163153,"908169"],[1680163154,"908169"],[1680163155,"908169"],[1680163156,"908169"],[1680163157,"908169"],[1680163158,"908169"],[1680163159,"908169"],[1680163160,"908169"],[1680163161,"908169"],[1680163162,"908295"],[1680163163,"908295"],[1680163164,"908295"],[1680163165,"908295"],[1680163166,"908295"],[1680163167,"908295"],[1680163168,"908295"],[1680163169,"908295"],[1680163170,"908295"],[1680163171,"908295"],[1680163172,"908295"],[1680163173,"908295"],[1680163174,"908295"],[1680163175,"908295"],[1680163176,"908295"],[1680163177,"908425"],[1680163178,"908425"],[1680163179,"908425"],[1680163180,"908425"],[1680163181,"908425"],[1680163182,"908425"],[1680163183,"908425"],[1680163184,"908425"],[1680163185,"908425"],[1680163186,"908425"],[1680163187,"908425"],[1680163188,"908425"],[1680163189,"908425"],[1680163190,"908425"],[1680163191,"908425"],[1680163192,"908558"],[1680163193,"908558"],[1680163194,"908558"],[1680163195,"908558"],[1680163196,"908558"],[1680163197,"908558"],[1680163198,"908558"],[1680163199,"908558"],[1680163200,"908558"]]}"#;

// create local session context with an in-memory table
fn create_context() -> Result<SessionContext> {
    use datafusion::arrow::datatypes::{Field, Schema};
    use datafusion::datasource::MemTable;
    // define a schema.
    let schema = Arc::new(Schema::new(vec![
        Field::new("name", DataType::Utf8, true),
        Field::new("cluster", DataType::Utf8, true),
        Field::new("container", DataType::Utf8, true),
        Field::new("endpoint", DataType::Utf8, true),
        Field::new("instance", DataType::Utf8, true),
        Field::new("job", DataType::Utf8, true),
        Field::new("namespace", DataType::Utf8, true),
        Field::new("_timestamp", DataType::Int64, false),
        Field::new("value", DataType::Int64, true),
    ]));

    // define data in two partitions
    // let batch1 = RecordBatch::try_new(
    //     schema.clone(),
    //     vec![
    //         Arc::new(Int64Array::from_slice([
    //             1680162780000000,
    //             1680162790000000,
    //             1680162800000000,
    //         ])),
    //         Arc::new(StringArray::from_slice(["joy", "jim", "john"])),
    //         Arc::new(Float32Array::from_slice([2.0, 4.0, 8.0])),
    //     ],
    // )?;
    // let batch2 = RecordBatch::try_new(
    //     schema.clone(),
    //     vec![
    //         Arc::new(Int64Array::from_slice([1680162780000000, 1680162790000000])),
    //         Arc::new(StringArray::from_slice(["joy", "jim"])),
    //         Arc::new(Float32Array::from_slice([64.0, 32.0])),
    //     ],
    // )?;

    let value: Results = serde_json::from_str(ORIGIN_VALUE).unwrap();

    let mut field1 = Vec::new();
    let mut field2 = Vec::new();
    let mut field3 = Vec::new();
    let mut field4 = Vec::new();
    let mut field6 = Vec::new();
    let mut field7 = Vec::new();
    let mut field8 = Vec::new();
    let mut field_times = Vec::new();
    let mut field_values = Vec::new();
    for val in value.values {
        field1.push(value.metric.__name__.clone());
        field2.push(value.metric.cluster.clone());
        field3.push(value.metric.container.clone());
        field4.push(value.metric.endpoint.clone());
        field6.push(value.metric.instance.clone());
        field7.push(value.metric.job.clone());
        field8.push(value.metric.namespace.clone());
        field_times.push(val.timestamp * 1000_000);
        field_values.push(val.value.parse::<i64>().unwrap());
    }

    let batch1 = RecordBatch::try_new(
        schema.clone(),
        vec![
            Arc::new(StringArray::from(field1)),
            Arc::new(StringArray::from(field2)),
            Arc::new(StringArray::from(field3)),
            Arc::new(StringArray::from(field4)),
            Arc::new(StringArray::from(field6)),
            Arc::new(StringArray::from(field7)),
            Arc::new(StringArray::from(field8)),
            Arc::new(Int64Array::from(field_times)),
            Arc::new(Int64Array::from(field_values)),
        ],
    )?;

    // declare a new context. In spark API, this corresponds to a new spark SQLsession
    let ctx = SessionContext::new();

    // declare a table in memory. In spark API, this corresponds to createDataFrame(...).
    let provider = MemTable::try_new(schema, vec![vec![batch1]])?;
    ctx.register_table("t", Arc::new(provider))?;
    Ok(ctx)
}

/// A UDAF has state across multiple rows, and thus we require a `struct` with that state.
#[derive(Debug)]
struct RateMean {
    prod: f64,
    n: u32,
    first_timestamp: i64,
    values: Vec<f64>,
    base_vlaues: Vec<(i64, f64)>,
}

impl RateMean {
    // how the struct is initialized
    pub fn new() -> Self {
        let value: Results = serde_json::from_str(ORIGIN_VALUE).unwrap();
        let base_vlaues: Vec<(i64, f64)> = value
            .values
            .iter()
            .map(|x| (x.timestamp * 1000_000, x.value.parse::<f64>().unwrap()))
            .collect();
        RateMean {
            prod: 0.0,
            n: 0,
            first_timestamp: 0,
            values: Vec::new(),
            base_vlaues,
        }
    }
}

// UDAFs are built using the trait `Accumulator`, that offers DataFusion the necessary functions
// to use them.
impl Accumulator for RateMean {
    // This function serializes our state to `ScalarValue`, which DataFusion uses
    // to pass this state between execution stages.
    // Note that this can be arbitrary data.
    fn state(&self) -> Result<Vec<ScalarValue>> {
        println!("state: called");
        Ok(vec![
            ScalarValue::from(self.prod),
            ScalarValue::from(self.n),
            ScalarValue::from(self.first_timestamp),
        ])
    }

    // DataFusion expects this function to return the final value of this aggregator.
    // in this case, this is the formula of the geometric mean
    fn evaluate(&self) -> Result<ScalarValue> {
        println!("evaluate: called, {}", self.first_timestamp);
        let time_max = get_microtimestamp(self.first_timestamp, "30s");
        let time_min = time_max - Duration::minutes(5).num_microseconds().unwrap();
        println!(
            "evaluate: called, first_timestamp: {:?}, {:?}",
            time_min, time_max
        );
        let values = self
            .base_vlaues
            .iter()
            .filter(|x| x.0 > time_min && x.0 <= time_max)
            .map(|x| x.1)
            .collect::<Vec<f64>>();
        // self.values.iter().for_each(|x| values.push(*x));
        let mut value = 0.0;
        for i in 1..values.len() {
            value += values[i] - values[i - 1];
        }
        value = value / values.len() as f64;
        println!("evaluate: value: {:?}, len={}", value, values.len());
        Ok(ScalarValue::from(value))
    }

    // DataFusion calls this function to update the accumulator's state for a batch
    // of inputs rows. In this case the product is updated with values from the first column
    // and the count is updated based on the row count
    fn update_batch(&mut self, values: &[ArrayRef]) -> Result<()> {
        println!("update_batch: called, values: {:?}", values);
        if values.is_empty() {
            return Ok(());
        }
        if self.first_timestamp == 0 {
            println!(
                "update_batch: first_timestamp 1: {:?}",
                values[2].as_any().downcast_ref::<Int64Array>().unwrap()
            );
            self.first_timestamp = values[2]
                .as_any()
                .downcast_ref::<Int64Array>()
                .unwrap()
                .value(0);
            println!(
                "update_batch: first_timestamp 2: {:?}",
                self.first_timestamp
            );
        }
        let vals = &values[3];
        (0..vals.len()).try_for_each(|index| {
            let v = ScalarValue::try_from_array(vals, index)?;

            if let ScalarValue::Float64(Some(value)) = v {
                self.values.push(value);
                self.n += 1;
            } else {
                unreachable!("")
            }
            Ok(())
        })
    }

    // Optimization hint: this trait also supports `update_batch` and `merge_batch`,
    // that can be used to perform these operations on arrays instead of single values.
    fn merge_batch(&mut self, states: &[ArrayRef]) -> Result<()> {
        println!("merge_batch: called, states: {:?}", states);
        if states.is_empty() {
            return Ok(());
        }
        let arr = &states[0];
        (0..arr.len()).try_for_each(|index| {
            let v = states
                .iter()
                .map(|array| ScalarValue::try_from_array(array, index))
                .collect::<Result<Vec<_>>>()?;
            if let (
                ScalarValue::Float64(Some(prod)),
                ScalarValue::UInt32(Some(n)),
                ScalarValue::Int64(Some(time)),
            ) = (&v[0], &v[1], &v[2])
            {
                self.prod += prod;
                self.n += n;
                self.first_timestamp = *time;
            } else {
                unreachable!("")
            }
            Ok(())
        })
    }

    fn size(&self) -> usize {
        println!("size: called, size: {:?}", std::mem::size_of_val(self));
        std::mem::size_of_val(self)
    }
}

#[tokio::main]
async fn main() -> Result<()> {
    let ctx = create_context()?;

    // here is where we define the UDAF. We also declare its signature:
    let rate_mean = create_my_udaf(
        // the name; used to represent it in plan descriptions and in the registry, to use in SQL.
        "rate",
        // the input type; DataFusion guarantees that the first entry of `values` in `update` has this type.
        vec![
            DataType::Utf8,
            DataType::Utf8,
            DataType::Int64,
            DataType::Float64,
        ],
        // the return type; DataFusion expects this to match the type returned by `evaluate`.
        Arc::new(DataType::Float64),
        Volatility::Immutable,
        // This is the accumulator factory; DataFusion uses it to create new accumulators.
        Arc::new(|_| Ok(Box::new(RateMean::new()))),
        // This is the description of the state. `state()` must match the types here.
        Arc::new(vec![DataType::Float64, DataType::UInt32, DataType::Int64]),
    );
    ctx.register_udaf(rate_mean);

    let df = ctx.sql("SELECT * FROM t").await?;
    df.show().await?;

    // let df = ctx
    //     .sql("SELECT date_bin(interval '15 second', to_timestamp_micros(_timestamp), to_timestamp('2001-01-01T00:00:00')) AS time, name, rate('5m', '30s', _timestamp, value) AS num FROM t GROUP BY time, name ORDER by time")
    //     .await?;
    // df.show().await?;
    // let batches = df.collect().await?;
    // let json_rows = arrowJson::writer::record_batches_to_json_rows(&batches[..]).unwrap();
    // let mut times = Vec::new();
    // let mut values = Vec::new();
    // for row in json_rows {
    //     let time = row["time"].as_str().unwrap().to_string()+"Z";
    //     let value = row["num"].as_f64().unwrap();
    //     // times.push(time);
    //     values.push((time,value));
    // }
    // println!("times: {:?}", times.split_off(20));
    // println!("values: {:?}", values.split_off(20));
    // println!("json_rows: {:?}", serde_json::to_string(&json_rows));
    Ok(())
}

pub fn create_my_udaf(
    name: &str,
    input_types: Vec<DataType>,
    return_type: Arc<DataType>,
    volatility: Volatility,
    accumulator: AccumulatorFunctionImplementation,
    state_type: Arc<Vec<DataType>>,
) -> AggregateUDF {
    let return_type: ReturnTypeFunction = Arc::new(move |_| Ok(return_type.clone()));
    let state_type: StateTypeFunction = Arc::new(move |_| Ok(state_type.clone()));
    AggregateUDF::new(
        name,
        &Signature::exact(input_types, volatility),
        &return_type,
        &accumulator,
        &state_type,
    )
}

fn get_microtimestamp(t: i64, _fmt: &str) -> i64 {
    let t = Utc.timestamp_nanos(t * 1000);
    let second = if t.second() >= 45 {
        60
    } else if t.second() >= 30 {
        45
    } else if t.second() >= 15 {
        30
    } else {
        15
    };
    let nt = Utc
        .with_ymd_and_hms(t.year(), t.month(), t.day(), t.hour(), t.minute(), 0)
        .unwrap();
    nt.timestamp_micros() + Duration::seconds(second).num_microseconds().unwrap()
}
